<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> Bootiful CRM </title>
    <script type="text/javascript">

        async function purchase(username) {
            const url = '/api/purchases';
            const data = {
                username: username,
                productId: 42,
                quantity: 420
            };

            const response = await fetch(url, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            });

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            return await response.json();
        }


        window.addEventListener('load', async () => {
            console.log('initializing the CRM client side')
            const response = await fetch('/api/me');
            const data = await response.json();
            const username = data['name']
            document.getElementById('name').innerText = username

            await purchase(username)


        })

    </script>
</head>
<body>
<p>Welcome, <b><span id="name"></span></b>, to the Spring CRM!</p>



</body>
</html>